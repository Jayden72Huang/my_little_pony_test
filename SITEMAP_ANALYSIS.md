# Sitemap é…ç½®åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥ç»“æœ

### 1. âœ… Config æ–‡ä»¶ä¸­çš„ Asset ç»‘å®š

**æ–‡ä»¶**: `wrangler.toml`

```toml
[assets]
directory = "out"
binding = "ASSETS"
```

**ç»“è®º**: âœ… **å·²æ­£ç¡®é…ç½® Asset ç»‘å®š**
- ç»‘å®šåç§°: `ASSETS`
- ç›®å½•: `out`
- è¿™æ„å‘³ç€ `out/` ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šä½œä¸ºé™æ€èµ„æºä¸Šä¼ åˆ° Cloudflare

### 2. âœ… Sitemap æ˜¯é™æ€çš„

**è¯æ®**:

1. **Next.js sitemap.ts é…ç½®**:
   ```typescript
   export const dynamic = "force-static";
   ```
   - æ˜ç¡®æ ‡è®°ä¸ºé™æ€ç”Ÿæˆ

2. **æ„å»ºæ—¶ç”Ÿæˆè„šæœ¬**:
   - æ–‡ä»¶: `scripts/generate-sitemap.js`
   - åœ¨ `postbuild` é’©å­ä¸­è¿è¡Œ
   - ç”Ÿæˆé™æ€æ–‡ä»¶åˆ°: `out/sitemap.xml`

3. **ç”Ÿæˆæµç¨‹**:
   ```
   npm run build
   â†’ Next.js æ„å»º
   â†’ postbuild é’©å­è¿è¡Œ
   â†’ scripts/generate-sitemap.js æ‰§è¡Œ
   â†’ ç”Ÿæˆ out/sitemap.xml (é™æ€æ–‡ä»¶)
   â†’ éƒ¨ç½²æ—¶ä¸Šä¼ åˆ° Cloudflare Assets
   ```

**ç»“è®º**: âœ… **Sitemap æ˜¯å®Œå…¨é™æ€çš„**
- åœ¨æ„å»ºæ—¶ç”Ÿæˆ
- ä½œä¸ºé™æ€æ–‡ä»¶å­˜å‚¨åœ¨ `out/sitemap.xml`
- éƒ¨ç½²æ—¶ä¸Šä¼ åˆ° Cloudflare Assets

### 3. âœ… Worker ä» ASSETS è·å–æ•°æ®

**æ–‡ä»¶**: `worker.js`

```javascript
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    
    // ç‰¹æ®Šå¤„ç† sitemap.xml
    if (url.pathname === '/sitemap.xml' || url.pathname === '/sitemap.xml/') {
      // âœ… ä» ASSETS ç»‘å®šä¸­è·å–é™æ€æ–‡ä»¶
      const assetResponse = await env.ASSETS.fetch(request);
      
      if (assetResponse.ok) {
        // âœ… è¯»å–é™æ€æ–‡ä»¶å†…å®¹
        const body = await assetResponse.text();
        
        // âœ… åˆ›å»ºæ–°å“åº”ï¼Œè®¾ç½®æ­£ç¡®çš„ Content-Type
        return new Response(body, {
          status: 200,
          headers: {
            'Content-Type': 'application/xml; charset=utf-8',
            'Cache-Control': 'public, max-age=3600, s-maxage=3600',
            'Access-Control-Allow-Origin': '*',
            'X-Robots-Tag': 'index, follow',
          },
        });
      }
      
      return new Response('Sitemap not found', { status: 404 });
    }
    
    // å¯¹äºå…¶ä»–è¯·æ±‚ï¼Œç›´æ¥è¿”å› assets
    return env.ASSETS.fetch(request);
  }
};
```

**å·¥ä½œæµç¨‹**:
1. ç”¨æˆ·è¯·æ±‚ `/sitemap.xml`
2. Worker æ‹¦æˆªè¯·æ±‚
3. ä» `env.ASSETS` ä¸­è·å–é™æ€æ–‡ä»¶ (`out/sitemap.xml`)
4. è¯»å–æ–‡ä»¶å†…å®¹
5. è®¾ç½®æ­£ç¡®çš„å“åº”å¤´
6. è¿”å›ç»™ç”¨æˆ·

**ç»“è®º**: âœ… **Worker æ­£ç¡®ä» ASSETS è·å–é™æ€æ–‡ä»¶å†…å®¹**

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ„å»ºé˜¶æ®µ (æœ¬åœ°)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ npm run build                                            â”‚
â”‚   â†’ Next.js æ„å»ºåº”ç”¨                                      â”‚
â”‚   â†’ postbuild é’©å­è¿è¡Œ                                    â”‚
â”‚   â†’ scripts/generate-sitemap.js æ‰§è¡Œ                     â”‚
â”‚   â†’ è¯»å– app/[locale]/utils/characterData.ts            â”‚
â”‚   â†’ è¯»å– app/[locale]/guides/ ç›®å½•                        â”‚
â”‚   â†’ ç”Ÿæˆ out/sitemap.xml (é™æ€æ–‡ä»¶ï¼Œ18.9 KB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éƒ¨ç½²é˜¶æ®µ (Cloudflare)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ npm run deploy                                           â”‚
â”‚   â†’ opennextjs-cloudflare build                          â”‚
â”‚   â†’ opennextjs-cloudflare deploy                        â”‚
â”‚   â†’ ä¸Šä¼  out/ ç›®å½•åˆ° Cloudflare Assets                   â”‚
â”‚   â†’ sitemap.xml å­˜å‚¨åœ¨ Assets ä¸­                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è¿è¡Œæ—¶ (Cloudflare Worker)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·è¯·æ±‚: https://mylittleponytest.xyz/sitemap.xml      â”‚
â”‚   â†’ Worker æ‹¦æˆªè¯·æ±‚                                      â”‚
â”‚   â†’ env.ASSETS.fetch(request) è·å–é™æ€æ–‡ä»¶              â”‚
â”‚   â†’ è¯»å– Assets ä¸­çš„ sitemap.xml                        â”‚
â”‚   â†’ è®¾ç½® Content-Type: application/xml; charset=utf-8   â”‚
â”‚   â†’ è¿”å›ç»™ç”¨æˆ·                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… æ€»ç»“

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Asset ç»‘å®š | âœ… å·²é…ç½® | `wrangler.toml` ä¸­æ­£ç¡®é…ç½®äº† `ASSETS` ç»‘å®š |
| Sitemap ç±»å‹ | âœ… é™æ€ | æ„å»ºæ—¶ç”Ÿæˆï¼Œå­˜å‚¨åœ¨ `out/sitemap.xml` |
| æ•°æ®æ¥æº | âœ… ASSETS | Worker ä» `env.ASSETS` è·å–é™æ€æ–‡ä»¶ |
| å†…å®¹ç”Ÿæˆ | âœ… æ„å»ºæ—¶ | ä»æºä»£ç è¯»å–è§’è‰²å’ŒæŒ‡å—æ•°æ®ç”Ÿæˆ |

## ğŸ” éªŒè¯

### æ£€æŸ¥ Asset ç»‘å®š
```bash
cat wrangler.toml | grep -A 2 "\[assets\]"
```

### æ£€æŸ¥é™æ€æ–‡ä»¶
```bash
ls -lh out/sitemap.xml
```

### æ£€æŸ¥ Worker ä»£ç 
```bash
cat worker.js | grep "ASSETS"
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é™æ€ç”Ÿæˆçš„ä¼˜åŠ¿**:
   - âœ… æ€§èƒ½å¥½ï¼ˆä¸éœ€è¦è¿è¡Œæ—¶ç”Ÿæˆï¼‰
   - âœ… ç¼“å­˜å‹å¥½
   - âœ… SEO å‹å¥½

2. **æ›´æ–°æœºåˆ¶**:
   - æ¯æ¬¡ `npm run build` éƒ½ä¼šé‡æ–°ç”Ÿæˆ sitemap
   - æ¯æ¬¡ `npm run deploy` éƒ½ä¼šä¸Šä¼ æ–°çš„ sitemap
   - å¦‚æœæ·»åŠ æ–°çš„è§’è‰²æˆ–æŒ‡å—ï¼Œéœ€è¦é‡æ–°æ„å»ºå’Œéƒ¨ç½²

3. **å½“å‰å†…å®¹**:
   - 106 ä¸ª URLï¼ˆåŒ…å«æ‰€æœ‰å¤šè¯­è¨€ç‰ˆæœ¬ï¼‰
   - æ–‡ä»¶å¤§å°: 18.9 KB
   - åŒ…å«: åŸºç¡€é¡µé¢ã€æµ‹è¯•é¡µé¢ã€è§’è‰²é¡µé¢ã€æŒ‡å—é¡µé¢
